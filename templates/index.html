{% extends "base.html" %}

{% block content %}
<h2>–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>

<!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
<form method="GET" action="{{ url_for('index') }}" class="search-form">
    <input type="text" name="search" value="{{ search_query }}" placeholder="–ü–æ–∏—Å–∫...">
    <select name="field">
        <option value="full_name" {% if search_field=='full_name' %}selected{% endif %}>–§–ò–û</option>
        <option value="position" {% if search_field=='position' %}selected{% endif %}>–î–æ–ª–∂–Ω–æ—Å—Ç—å</option>
        <option value="phone" {% if search_field=='phone' %}selected{% endif %}>–¢–µ–ª–µ—Ñ–æ–Ω</option>
        <option value="email" {% if search_field=='email' %}selected{% endif %}>Email</option>
        <option value="on_probation" {% if search_field=='on_probation' %}selected{% endif %}>–ò—Å–ø. —Å—Ä–æ–∫</option>
    </select>
    <button type="submit">–ù–∞–π—Ç–∏</button>
</form>

<!-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
<table class="employees-table">
    <thead>
        <tr>
            <th><a href="?sort_by=id&order={% if sort_by=='id' and sort_order=='asc' %}desc{% else %}asc{% endif %}">ID</a></th>
            <th><a href="?sort_by=full_name&order={% if sort_by=='full_name' and sort_order=='asc' %}desc{% else %}asc{% endif %}">–§–ò–û</a></th>
            <th><a href="?sort_by=position&order={% if sort_by=='position' and sort_order=='asc' %}desc{% else %}asc{% endif %}">–î–æ–ª–∂–Ω–æ—Å—Ç—å</a></th>
            <th><a href="?sort_by=gender&order={% if sort_by=='gender' and sort_order=='asc' %}desc{% else %}asc{% endif %}">–ü–æ–ª</a></th>
            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th>Email</th>
            <th><a href="?sort_by=hire_date&order={% if sort_by=='hire_date' and sort_order=='asc' %}desc{% else %}asc{% endif %}">–î–∞—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</a></th>
            <!-- –î–û–ë–ê–í–õ–Ø–ï–ú –ö–û–õ–û–ù–ö–£ –î–õ–Ø –ò–°–ü–´–¢–ê–¢–ï–õ–¨–ù–û–ì–û –°–†–û–ö–ê -->
            <th><a href="?sort_by=on_probation&order={% if sort_by=='on_probation' and sort_order=='asc' %}desc{% else %}asc{% endif %}">–ò—Å–ø. —Å—Ä–æ–∫</a></th>
            {% if current_user.is_authenticated %}
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for employee in employees %}
        <tr>
            <td>{{ employee.id }}</td>
            <td>{{ employee.full_name }}</td>
            <td>{{ employee.position }}</td>
            <td>{{ employee.gender }}</td>
            <td>{{ employee.phone }}</td>
            <td>{{ employee.email }}</td>
            <td>{{ employee.hire_date.strftime('%d.%m.%Y') }}</td>
            <!-- –î–û–ë–ê–í–õ–Ø–ï–ú –Ø–ß–ï–ô–ö–£ –°–û –°–¢–ê–¢–£–°–û–ú -->
            <td>
                {% if employee.on_probation %}
                <span class="probation-yes">‚úÖ –î–∞</span>
                {% else %}
                <span class="probation-no">‚ùå –ù–µ—Ç</span>
                {% endif %}
            </td>
            {% if current_user.is_authenticated %}
            <td class="actions">
                <a href="{{ url_for('edit_employee', id=employee.id) }}" class="btn-edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                <form action="{{ url_for('delete_employee', id=employee.id) }}" method="POST" style="display:inline;">
                    <button type="submit" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?')" class="btn-delete">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                </form>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
<div class="pagination">
    {% if pagination.has_prev %}
        <a href="?page={{ pagination.prev_num }}&search={{ search_query }}&field={{ search_field }}&sort_by={{ sort_by }}&order={{ sort_order }}">‚Üê –ù–∞–∑–∞–¥</a>
    {% endif %}
    
    <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ pagination.page }} –∏–∑ {{ pagination.pages }}</span>
    <span>(–í—Å–µ–≥–æ: {{ pagination.total }} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤)</span>
    
    {% if pagination.has_next %}
        <a href="?page={{ pagination.next_num }}&search={{ search_query }}&field={{ search_field }}&sort_by={{ sort_by }}&order={{ sort_order }}">–î–∞–ª–µ–µ ‚Üí</a>
    {% endif %}
</div>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
{% if not current_user.is_authenticated %}
<div class="info-box">
    <p>–í—ã –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∫–∞–∫ –≥–æ—Å—Ç—å. –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ <a href="{{ url_for('login') }}">–≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a>.</p>
</div>
{% endif %}
{% endblock %}